# Commands

build-mac:
  command: |
    cd packages/server
    OSGI_PLATFORM=cocoa.macosx.x86_64 ./gradlew shadowJar
    cd -

    $(go env GOPATH)/bin/xgo \
      -branch={{.branch}} \
      -targets=darwin/amd64 \
      {{.repo}}
build-linux:
  command: |
    cd packages/server
    OSGI_PLATFORM=gtk.linux.x86_64 ./gradlew shadowJar
    cd -

    $(go env GOPATH)/bin/xgo \
      -branch={{.branch}} \
      -targets=linux/* \
      {{.repo}}
build-windows:
  command: |
    cd packages/server
    OSGI_PLATFORM=win32.win32.x86_64 ./gradlew shadowJar
    cd -

    $(go env GOPATH)/bin/xgo \
      -ldflags="-H windowsgui" \
      -branch={{.branch}} \
      -targets=windows/* \
      {{.repo}}
build-all:
  summary: |
    Build for Linux, Windows, and macOS
    Install `xgo` using `go get github.com/karalabe/xgo`
  command: |
    robo -c {{ .robo.file }} build-linux
    robo -c {{ .robo.file }} build-windows
    robo -c {{ .robo.file }} build-mac

##########
# Settings

variables:
  repo: github.com/patarapolw/make-html
  branch: $(git branch --show-current)
